{% extends "base.html" %}

{% block content %}
<div class="recruiter-portal" style="padding: 40px 5%;">
    
    <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 40px; border-bottom: 1px solid var(--glass-border); padding-bottom: 20px;">
        <div>
            <h1 style="color: var(--queen-pink); font-size: 2.5rem;">Recruiter Command Center</h1>
            <p style="color: var(--old-lavender);">Reviewing incoming DNA Match Requests</p>
        </div>
        <div class="glass-card" style="padding: 10px 20px; text-align: right;">
            <span style="display: block; font-size: 0.7rem; color: var(--old-lavender);">TOTAL APPLICATIONS</span>
            <strong style="font-size: 1.5rem; color: var(--pearly-purple);">{{ apps|length }}</strong>
        </div>
    </div>

    <div class="glass-card" style="overflow: hidden;">
        <table style="width: 100%; border-collapse: collapse; text-align: left;">
            <thead style="background: rgba(255,255,255,0.03);">
                <tr style="color: var(--queen-pink);">
                    <th style="padding: 20px;">CANDIDATE (DNA)</th>
                    <th>JOB ROLE</th>
                    <th>TRUST SCORE</th>
                    <th>MATCH %</th>
                    <th>ACTION</th>
                </tr>
            </thead>
            <tbody>
                {% for app in apps %}
                <tr style="border-bottom: 1px solid var(--glass-border); transition: 0.3s;" class="table-row-hover">
                    <td style="padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <img src="{{ app.applicant.profile_picture }}" style="width: 40px; height: 40px; border-radius: 50%; border: 1px solid var(--middle-purple);">
                            <div>
                                <div style="font-weight: 700;">{{ app.applicant.username }}</div>
                                <div style="font-size: 0.75rem; color: var(--old-lavender);">{{ app.applicant.email }}</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div style="font-weight: 600;">{{ app.job.title }}</div>
                        <div style="font-size: 0.75rem; color: var(--old-lavender);">{{ app.job.company }}</div>
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 40px; height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; overflow: hidden;">
                                <div style="width: {{ app.applicant.trust_score }}%; height: 100%; background: var(--pearly-purple);"></div>
                            </div>
                            <span style="font-weight: 800; color: var(--pearly-purple);">{{ app.applicant.trust_score }}</span>
                        </div>
                    </td>
                    <td>
                        <span style="color: #50C878; font-weight: 800;">92% Match</span>
                    </td>
                    <td style="padding-right: 20px;">
                        <div style="display: flex; gap: 10px;">
                            <select onchange="updateStatus({{ app.id }}, this.value)" class="glass-card" style="background: var(--jacarta); color: white; padding: 5px 10px; border-radius: 8px; border: 1px solid var(--glass-border);">
                                <option value="Delivered" {% if app.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                                <option value="Verified" {% if app.status == 'Verified' %}selected{% endif %}>Verified</option>
                                <option value="Accepted" {% if app.status == 'Accepted' %}selected{% endif %}>Accepted</option>
                                <option value="Rejected" {% if app.status == 'Rejected' %}selected{% endif %}>Rejected</option>
                            </select>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
function updateStatus(appId, newStatus) {
    fetch(`/recruiter/update_status/${appId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ status: newStatus })
    })
    .then(res => res.json())
    .then(data => {
        if(data.status === 'success') {
            // Trigger a toast notification (using the helper from jobs.js)
            showToast("Status Updated", `Application #${appId} moved to ${newStatus}`, "success");
        }
    });
}
</script>
{% endblock %}